<!doctype html>
<html>
	<head>
		<title>Following</title>

		<script>
			if (typeof module === 'object') {window.module = module; module = undefined;} 
		</script>

		<link rel="stylesheet" href="style/style.css">
		<script src="javascript/jquery-2.2.4.min.js"></script>
		
		<script>
			function closeApp() {
			    window.close()
			}

			function doFetch() {
			    var e = window.location.href.split("?")[1].split("#");
			    userID = e[0];
                
                document.title = `${e[2]} - Following`;
                $('#title').text(`${e[2]} - Following`);
			    
			    max = e[1], $.ajax({
			        url: "http://live.ksmobile.net/follow/getfollowinglistship",
			        data: {
			            page_size: ps,
			            page_index: cp,
			            access_token: userID
			        },
			        cache: !1,
			        type: "GET",
			        dataType: "json",
			        success: function(e) {
			            if (e.data.length > 0) {
			                for (i = 0; i < e.data.length; i++) {
			                	if (e.data[i].uid.length > 15) {
			                		var sex = e.data[i].sex < 0 ? '' : (e.data[i].sex == 0 ? 'female' : 'male');
									$("#small_user_list").append(`
										<div title="Click to view user's videos." class="user_entry small clickable ${sex}" onClick="getVideos('${e.data[i].uid}')">
											<img class="avatar" src="${e.data[i].face}" onerror="this.src='images/blank.png'">
											<h4>${e.data[i].nickname}</h4>
										</div>
									`);
				                }
			                }
		                    cp++;
		                    doFetch();
			            }
			        }
			    })
			}

			function getVideos(e) {
				var {ipcRenderer} = require('electron')
				ipcRenderer.send('submit-search', { userid: e });
			}
			var ps = 20,
			    cp = 1,
			    ct = 0,
			    max = 0,
			    userID = "";
			$(function() {
				$('#small_user_list').html('');
			    setTimeout(function() {
			        doFetch()
			    }, 250);
			});
		</script>
		
	</head>
	<body>
		<header class="small">
			<h4 id="title">Following</h4>
			<img class="close-icon" src="images/ic_close_white_24px.svg" onClick="closeApp()">
		</header>
		<div id="small_user_list"></div>
	</body>
</html>