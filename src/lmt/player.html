<!doctype html>
<html>
	<head>
		<title>Player</title>

		<script>
			if (typeof module === 'object') {window.module = module; module = undefined;} 
		</script>

		<script src="javascript/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="javascript/hls.js"></script>

		<script>
			$(function(){
				var t=window.location.href.split('#'), u=t[1], uu = t[1].split('/'), f=uu[uu.length - 1];
				if (f.indexOf('playlist') > -1) {
					f = uu[uu.length - 2]+'/'+uu[uu.length-1];
				}

				document.title = u;
				var video = document.getElementById('videoplayer');
				var hls = new Hls();
				
				hls.loadSource(u);
				hls.attachMedia(video);

				hls.on(Hls.Events.MANIFEST_PARSED,function() {
					video.play();
				});
	
				$('header h4').html('Player - ' + f);

				video.addEventListener('loadeddata', function() {
					$('#video').show();
					$('#playpause').removeClass('icon-media-play').addClass('icon-media-pause');
				}, false);

				video.addEventListener('timeupdate', function(e) {
					// For larger bar steps only use 100 or 1000, for smoother and smaller bar steps use 1000000 
					var a = Math.round((video.currentTime / video.duration) * 1000000) / 1000000, b = $('#progressbar').width() * a;
					$('.bar').css({ width: b });
				}, false);

				document.getElementById('progressbar').addEventListener('click', function(e){
					var a = e.pageX - this.offsetLeft, b = $('#progressbar').width(), c = video.duration, p = Math.round((a / b) * 100) / 100, t = p * c;
					video.currentTime = t;
				}, false);

				$('#videoplayer').mouseout(function(){
					$('.video_controls').css({ opacity: 0 });
				});

				$('.video_controls').mouseout(function(){
					$('.video_controls').css({ opacity: 0 });
				});

				$('#videoplayer').mouseover(function(){
					$('.video_controls').css({ opacity: 1.0 });
				});

				$('.video_controls').mouseover(function(){
					$('.video_controls').css({ opacity: 1.0 });
				});

				$(window).on('close', function() {
					video.pause();
				});

			});

			function PlayPause() {
				var o = document.getElementById('videoplayer');
				if (o.paused == true) {
					o.play();
					$('#playpause').removeClass('icon-media-play').addClass('icon-media-pause');
				} else {
					o.pause();
					$('#playpause').addClass('icon-media-play').removeClass('icon-media-pause');
				}

			}
		</script>

        <link rel="stylesheet" href="style/style.css">

	</head>
	<body>
		<video id="videoplayer" autoplay></video>
		<div class="video_controls">
			<a id="playpause" class="button icon icon-media-pause" onClick="PlayPause()"></a>
			<div class="progress" id="progressbar"><div class="bar"></div></div>

		</div>
	</body>
</html>