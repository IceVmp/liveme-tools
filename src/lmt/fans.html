<!doctype html>
<html>
	<head>
		<title>Fans</title>

		<script>
			if (typeof module === 'object') {window.module = module; module = undefined;} 
		</script>

		<link rel="stylesheet" href="style/style.css">
		<script src="javascript/jquery-3.2.1.min.js"></script>

		<script>
			
			const LiveMe = require('liveme-api'), { ipcRenderer } = require('electron');
			var page = 1, userid = '';

			$(function(){
			    var e = window.location.href.split("?")[1].split("#");
                userid = e[0];
                
                document.title = `${e[2]} - Fans`;
				doFetch();				
			})

            function doFetch() {
				LiveMe.getFans(userid, 10, page)
					.then(results => {
						for(var i = 0; i < results.length; i++) {

	                		var sex = results[i].sex < 0 ? '' : (results[i].sex == 0 ? 'female' : 'male');

							$(".list").append(`
								<div class="item small clickable" onClick="getVideos('${results[i].uid}')" id="${results[i].uid}">
									<div class="avatar">
										<img src="${results[i].face}" class="${sex}" onerror="this.src='images/blank.png'">
									</div>
									<div class="content">
										<div class="header">${results[i].nickname}</div>
										<div class="meta">
											<div>Country: ${results[i].countryCode} &nbsp;&nbsp;- </div>
											<div>Level: ${results[i].level} </div>
										</div>
									</div>
								</div>
							`);
						}
						if (results.length == 10) {
							page++;
							setTimeout(() => {
								doFetch();
							}, 25);
						}							
					})
					.catch(err => {
						console.log('Error: ' + err);
					});

            }

			function getVideos(e) {
				$('#'+e).addClass('marked');
				ipcRenderer.send('submit-search', { userid: e });
			}

		</script>
		
	</head>
	<body>
		<main>
			<div class="list"></div>
		</main>
	</body>
</html>